<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ach: include/ach.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>include/ach.h</h1>  </div>
</div>
<div class="contents">
<a href="ach_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* -*- mode: C; c-basic-offset: 4 -*- */</span>
<a name="l00002"></a>00002 <span class="comment">/* ex: set shiftwidth=4 tabstop=4 expandtab: */</span>
<a name="l00003"></a>00003 <span class="comment">/*</span>
<a name="l00004"></a>00004 <span class="comment"> * Copyright (c) 2008-2012, Georgia Tech Research Corporation</span>
<a name="l00005"></a>00005 <span class="comment"> * All rights reserved.</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> * Author(s): Neil T. Dantam &lt;ntd@gatech.edu&gt;</span>
<a name="l00008"></a>00008 <span class="comment"> * Georgia Tech Humanoid Robotics Lab</span>
<a name="l00009"></a>00009 <span class="comment"> * Under Direction of Prof. Mike Stilman &lt;mstilman@cc.gatech.edu&gt;</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> *</span>
<a name="l00012"></a>00012 <span class="comment"> * This file is provided under the following &quot;BSD-style&quot; License:</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> *</span>
<a name="l00015"></a>00015 <span class="comment"> *   Redistribution and use in source and binary forms, with or</span>
<a name="l00016"></a>00016 <span class="comment"> *   without modification, are permitted provided that the following</span>
<a name="l00017"></a>00017 <span class="comment"> *   conditions are met:</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> *   * Redistributions of source code must retain the above copyright</span>
<a name="l00020"></a>00020 <span class="comment"> *     notice, this list of conditions and the following disclaimer.</span>
<a name="l00021"></a>00021 <span class="comment"> *</span>
<a name="l00022"></a>00022 <span class="comment"> *   * Redistributions in binary form must reproduce the above</span>
<a name="l00023"></a>00023 <span class="comment"> *     copyright notice, this list of conditions and the following</span>
<a name="l00024"></a>00024 <span class="comment"> *     disclaimer in the documentation and/or other materials provided</span>
<a name="l00025"></a>00025 <span class="comment"> *     with the distribution.</span>
<a name="l00026"></a>00026 <span class="comment"> *</span>
<a name="l00027"></a>00027 <span class="comment"> *   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND</span>
<a name="l00028"></a>00028 <span class="comment"> *   CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES,</span>
<a name="l00029"></a>00029 <span class="comment"> *   INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF</span>
<a name="l00030"></a>00030 <span class="comment"> *   MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span>
<a name="l00031"></a>00031 <span class="comment"> *   DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR</span>
<a name="l00032"></a>00032 <span class="comment"> *   CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<a name="l00033"></a>00033 <span class="comment"> *   SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<a name="l00034"></a>00034 <span class="comment"> *   LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF</span>
<a name="l00035"></a>00035 <span class="comment"> *   USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED</span>
<a name="l00036"></a>00036 <span class="comment"> *   AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span>
<a name="l00037"></a>00037 <span class="comment"> *   LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN</span>
<a name="l00038"></a>00038 <span class="comment"> *   ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span>
<a name="l00039"></a>00039 <span class="comment"> *   POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00040"></a>00040 <span class="comment"> *</span>
<a name="l00041"></a>00041 <span class="comment"> */</span>
<a name="l00042"></a>00042 
<a name="l00143"></a>00143 <span class="comment">/*</span>
<a name="l00144"></a>00144 <span class="comment"> * Shared Memory Layout:</span>
<a name="l00145"></a>00145 <span class="comment"> *</span>
<a name="l00146"></a>00146 <span class="comment"> *    ________</span>
<a name="l00147"></a>00147 <span class="comment"> *   | Header |</span>
<a name="l00148"></a>00148 <span class="comment"> *   |--------|</span>
<a name="l00149"></a>00149 <span class="comment"> *   | GUARDH |</span>
<a name="l00150"></a>00150 <span class="comment"> *   |--------|</span>
<a name="l00151"></a>00151 <span class="comment"> *   | Index  |</span>
<a name="l00152"></a>00152 <span class="comment"> *   |        |</span>
<a name="l00153"></a>00153 <span class="comment"> *   |        |</span>
<a name="l00154"></a>00154 <span class="comment"> *   |--------|</span>
<a name="l00155"></a>00155 <span class="comment"> *   | GUARDI |</span>
<a name="l00156"></a>00156 <span class="comment"> *   |--------|</span>
<a name="l00157"></a>00157 <span class="comment"> *   |  Data  |</span>
<a name="l00158"></a>00158 <span class="comment"> *   |        |</span>
<a name="l00159"></a>00159 <span class="comment"> *   |        |</span>
<a name="l00160"></a>00160 <span class="comment"> *   |        |</span>
<a name="l00161"></a>00161 <span class="comment"> *   |        |</span>
<a name="l00162"></a>00162 <span class="comment"> *   |        |</span>
<a name="l00163"></a>00163 <span class="comment"> *   |        |</span>
<a name="l00164"></a>00164 <span class="comment"> *   |--------|</span>
<a name="l00165"></a>00165 <span class="comment"> *   | GUARDD |</span>
<a name="l00166"></a>00166 <span class="comment"> *   |________|</span>
<a name="l00167"></a>00167 <span class="comment"> */</span>
<a name="l00168"></a>00168 
<a name="l00169"></a>00169 <span class="preprocessor">#ifndef ACH_H</span>
<a name="l00170"></a>00170 <span class="preprocessor"></span><span class="preprocessor">#define ACH_H</span>
<a name="l00171"></a>00171 <span class="preprocessor"></span>
<a name="l00172"></a>00172 <span class="comment">/* restict only in C99 */</span>
<a name="l00173"></a>00173 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l00174"></a>00174 <span class="preprocessor"></span>
<a name="l00175"></a>00175 <span class="preprocessor"># define ACH_RESTRICT</span>
<a name="l00176"></a>00176 <span class="preprocessor"></span><span class="preprocessor">#elif  __STDC_VERSION__ &lt; 199901L</span>
<a name="l00177"></a>00177 <span class="preprocessor"></span>
<a name="l00178"></a><a class="code" href="ach_8h.html#a36320691b8bddb17d7416a7c57e296f5">00178</a> <span class="preprocessor">#  define ACH_RESTRICT</span>
<a name="l00179"></a>00179 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00180"></a>00180 <span class="preprocessor"></span>
<a name="l00181"></a>00181 <span class="preprocessor"># define ACH_RESTRICT restrict</span>
<a name="l00182"></a>00182 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00183"></a>00183 <span class="preprocessor"></span>
<a name="l00184"></a>00184 
<a name="l00185"></a>00185 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l00186"></a>00186 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> {
<a name="l00187"></a>00187 <span class="preprocessor">#endif</span>
<a name="l00188"></a>00188 <span class="preprocessor"></span>
<a name="l00190"></a><a class="code" href="ach_8h.html#abb5d1fae5fa66a03d7d8d4761011e86c">00190</a> <span class="preprocessor">#define ACH_CHAN_NAME_MAX 64ul</span>
<a name="l00191"></a>00191 <span class="preprocessor"></span>
<a name="l00193"></a><a class="code" href="ach_8h.html#afd256125e8e540929dd1b945e4a9c791">00193</a> <span class="preprocessor">#define ACH_CHAN_NAME_PREFIX &quot;/achshm-&quot;</span>
<a name="l00194"></a>00194 <span class="preprocessor"></span>
<a name="l00196"></a><a class="code" href="ach_8h.html#a01aa865155a30c16a6a5c5643d0f6cfe">00196</a> <span class="preprocessor">#define ACH_INTR_RETRY 8</span>
<a name="l00197"></a>00197 <span class="preprocessor"></span>
<a name="l00202"></a><a class="code" href="ach_8h.html#a6ee6cd8dede61e5c4413a70317f63731">00202</a> <span class="preprocessor">#define ACH_SHM_MAGIC_NUM 0xb07511f3</span>
<a name="l00203"></a>00203 <span class="preprocessor"></span>
<a name="l00204"></a>00204 
<a name="l00210"></a><a class="code" href="ach_8h.html#a4c1ae385acbd87b06971e19753462423">00210</a> <span class="preprocessor">#define ACH_SHM_GUARD_HEADER_NUM ((uint64_t)0x1A2A3A4A5A6A7A8ALLU)</span>
<a name="l00211"></a>00211 <span class="preprocessor"></span>
<a name="l00216"></a><a class="code" href="ach_8h.html#a9756b6b93b39fbed2645e463dfc7d327">00216</a> <span class="preprocessor">#define ACH_SHM_GUARD_INDEX_NUM ((uint64_t)0x1B2B3B4B5B6B7B8BLLU)</span>
<a name="l00217"></a>00217 <span class="preprocessor"></span>
<a name="l00224"></a><a class="code" href="ach_8h.html#ae81e27183c5ad6111cf19685f942ab7e">00224</a> <span class="preprocessor">#define ACH_SHM_GUARD_DATA_NUM ((uint64_t)0x1C2C3C4C5C6C7C8CLLU)</span>
<a name="l00225"></a>00225 <span class="preprocessor"></span>
<a name="l00227"></a><a class="code" href="ach_8h.html#a6d56e0e44a3792918ce459a4a8deaad4">00227</a>     <span class="keyword">typedef</span> <span class="keyword">enum</span> {
<a name="l00228"></a><a class="code" href="ach_8h.html#a6d56e0e44a3792918ce459a4a8deaad4afefe1a7f013444d4d3eeff6a47f1874e">00228</a>         <a class="code" href="ach_8h.html#a6d56e0e44a3792918ce459a4a8deaad4afefe1a7f013444d4d3eeff6a47f1874e" title="Call successful.">ACH_OK</a> = 0,             
<a name="l00229"></a><a class="code" href="ach_8h.html#a6d56e0e44a3792918ce459a4a8deaad4a1af1e6af38bf18218a80b06195769062">00229</a>         <a class="code" href="ach_8h.html#a6d56e0e44a3792918ce459a4a8deaad4a1af1e6af38bf18218a80b06195769062" title="buffer to small to hold frame">ACH_OVERFLOW</a> = 1,       
<a name="l00230"></a><a class="code" href="ach_8h.html#a6d56e0e44a3792918ce459a4a8deaad4a136cba32d00e1e1065b31703bbf51f5a">00230</a>         <a class="code" href="ach_8h.html#a6d56e0e44a3792918ce459a4a8deaad4a136cba32d00e1e1065b31703bbf51f5a" title="invalid channel name">ACH_INVALID_NAME</a> = 2,   
<a name="l00231"></a><a class="code" href="ach_8h.html#a6d56e0e44a3792918ce459a4a8deaad4a268e9e8e27c0d5f83ac4eb44369b772a">00231</a>         <a class="code" href="ach_8h.html#a6d56e0e44a3792918ce459a4a8deaad4a268e9e8e27c0d5f83ac4eb44369b772a" title="shared memory file didn&amp;#39;t look right">ACH_BAD_SHM_FILE</a> = 3,   
<a name="l00232"></a><a class="code" href="ach_8h.html#a6d56e0e44a3792918ce459a4a8deaad4a07c7b309136d251e83cab6c9647b634b">00232</a>         <a class="code" href="ach_8h.html#a6d56e0e44a3792918ce459a4a8deaad4a07c7b309136d251e83cab6c9647b634b" title="a system call failed">ACH_FAILED_SYSCALL</a> = 4, 
<a name="l00233"></a><a class="code" href="ach_8h.html#a6d56e0e44a3792918ce459a4a8deaad4a33c60b8c61f290af044ae15970ff0495">00233</a>         <a class="code" href="ach_8h.html#a6d56e0e44a3792918ce459a4a8deaad4a33c60b8c61f290af044ae15970ff0495" title="no new data in the channel">ACH_STALE_FRAMES</a> = 5,   
<a name="l00234"></a><a class="code" href="ach_8h.html#a6d56e0e44a3792918ce459a4a8deaad4ab225cc19cdc5defd7f2cc034dd1308db">00234</a>         <a class="code" href="ach_8h.html#a6d56e0e44a3792918ce459a4a8deaad4ab225cc19cdc5defd7f2cc034dd1308db" title="we missed the next frame">ACH_MISSED_FRAME</a> = 6,   
<a name="l00235"></a><a class="code" href="ach_8h.html#a6d56e0e44a3792918ce459a4a8deaad4a6403ef3ca27827f131e232e624ada43f">00235</a>         <a class="code" href="ach_8h.html#a6d56e0e44a3792918ce459a4a8deaad4a6403ef3ca27827f131e232e624ada43f" title="timeout before frame received">ACH_TIMEOUT</a> = 7,        
<a name="l00236"></a><a class="code" href="ach_8h.html#a6d56e0e44a3792918ce459a4a8deaad4a50ab3aceb9e90eab0abcb771fcbff28f">00236</a>         <a class="code" href="ach_8h.html#a6d56e0e44a3792918ce459a4a8deaad4a50ab3aceb9e90eab0abcb771fcbff28f" title="shm already exists">ACH_EEXIST</a> = 8,         
<a name="l00237"></a><a class="code" href="ach_8h.html#a6d56e0e44a3792918ce459a4a8deaad4a26094dd35827f5eeff52ac042adee837">00237</a>         <a class="code" href="ach_8h.html#a6d56e0e44a3792918ce459a4a8deaad4a26094dd35827f5eeff52ac042adee837" title="shm doesn&amp;#39;t">ACH_ENOENT</a> = 9,         
<a name="l00238"></a>00238         ACH_CLOSED = 10,
<a name="l00239"></a>00239         ACH_BUG = 11,
<a name="l00240"></a>00240         ACH_EINVAL = 12,
<a name="l00241"></a>00241         ACH_CORRUPT = 13
<a name="l00242"></a>00242     } ach_status_t;
<a name="l00243"></a>00243 
<a name="l00245"></a><a class="code" href="ach_8h.html#acda036966ec908f2a2dc39cf715b3df1">00245</a>     <span class="keyword">typedef</span> <span class="keyword">enum</span> {
<a name="l00246"></a><a class="code" href="ach_8h.html#acda036966ec908f2a2dc39cf715b3df1a7755a18769b2f41fbe9c85db1975cb69">00246</a>         ACH_CHAN_STATE_INIT,    
<a name="l00247"></a><a class="code" href="ach_8h.html#acda036966ec908f2a2dc39cf715b3df1a050401a7ebafd30f94118545d1bc5ec3">00247</a>         ACH_CHAN_STATE_RUN,     
<a name="l00248"></a>00248         <span class="comment">/* //ACH_CHAN_STATE_READING, ///&lt; readers using channel */</span>
<a name="l00249"></a>00249         <span class="comment">/* //ACH_CHAN_STATE_WRITING, ///&lt; writer modifying channel */</span>
<a name="l00250"></a><a class="code" href="ach_8h.html#acda036966ec908f2a2dc39cf715b3df1a320260e6f66945ab4b6fdc315e99711e">00250</a>         <a class="code" href="ach_8h.html#acda036966ec908f2a2dc39cf715b3df1a320260e6f66945ab4b6fdc315e99711e" title="channel has been closed">ACH_CHAN_STATE_CLOSED</a>   
<a name="l00251"></a>00251     } ach_chan_state_t;
<a name="l00252"></a>00252 
<a name="l00253"></a>00253 
<a name="l00254"></a>00254 
<a name="l00255"></a>00255 
<a name="l00257"></a><a class="code" href="ach_8h.html#ae42d0299e86224c0ac39dc58959bd7fe">00257</a>     <span class="keyword">typedef</span> <span class="keyword">enum</span> {
<a name="l00264"></a><a class="code" href="ach_8h.html#ae42d0299e86224c0ac39dc58959bd7fea84945ef892a7ea70b1c28734957b9885">00264</a>         <a class="code" href="ach_8h.html#ae42d0299e86224c0ac39dc58959bd7fea84945ef892a7ea70b1c28734957b9885" title="Blocks until an unseen message arrives or timeout.">ACH_O_WAIT</a> = 0x01,
<a name="l00270"></a><a class="code" href="ach_8h.html#ae42d0299e86224c0ac39dc58959bd7fea42b2241346389ea6f63b685b19346d74">00270</a>         <a class="code" href="ach_8h.html#ae42d0299e86224c0ac39dc58959bd7fea42b2241346389ea6f63b685b19346d74" title="Reads the newest message out of the channel.">ACH_O_LAST</a> = 0x02,
<a name="l00271"></a>00271         ACH_O_COPY = 0x04,
<a name="l00272"></a>00272         ACH_O_SKIP = 0x08
<a name="l00273"></a>00273     } ach_get_opts_t;
<a name="l00274"></a>00274 
<a name="l00280"></a><a class="code" href="structach__header__t.html">00280</a>     <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00281"></a><a class="code" href="structach__header__t.html#a2b3fe30a9e7f9fe192e19fb3ee04c2c8">00281</a>         uint32_t magic;          
<a name="l00282"></a><a class="code" href="structach__header__t.html#a46437c42eb0dc8f00af4ecd91539f79f">00282</a>         <span class="keywordtype">size_t</span> len;              
<a name="l00283"></a><a class="code" href="structach__header__t.html#adc943882b1a4c31492d48e05e9ed2003">00283</a>         <span class="keywordtype">size_t</span> index_cnt;        
<a name="l00284"></a><a class="code" href="structach__header__t.html#ac3a0b9cc9c357bfa04eb2e3c69fd8ab8">00284</a>         <span class="keywordtype">size_t</span> data_size;        
<a name="l00285"></a><a class="code" href="structach__header__t.html#ae1dc7f6b5b662efba797155226fdbf93">00285</a>         <span class="keywordtype">size_t</span> data_head;        
<a name="l00286"></a><a class="code" href="structach__header__t.html#a6f5b6ea50e8b913c5863ff7b19d6a41b">00286</a>         <span class="keywordtype">size_t</span> data_free;        
<a name="l00287"></a><a class="code" href="structach__header__t.html#a26e129af024067341db090d9eef816b2">00287</a>         <span class="keywordtype">size_t</span> index_head;       
<a name="l00288"></a><a class="code" href="structach__header__t.html#a2a187943af11a7cbce0b936b6dbb134e">00288</a>         <span class="keywordtype">size_t</span> index_free;       
<a name="l00289"></a><a class="code" href="structach__header__t.html#a6c5e089dab8a32c2788139896460d856">00289</a>         <span class="keywordtype">int</span> state;               
<a name="l00290"></a><a class="code" href="structach__header__t.html#abccc8599e0c62b5e3274df29f3dd8cc1">00290</a>         <span class="keywordtype">int</span> refcount;            
<a name="l00291"></a><a class="code" href="structach__header__t.html#a5f5a2e669d0a3b82d2f3e557974d1f25">00291</a>         <span class="keywordtype">int</span> anon;                
<a name="l00292"></a><a class="code" href="structach__header__t.html#a40a74c9be148bd3cf9299620df06dc94">00292</a>         <span class="keywordtype">char</span> name[1+ACH_CHAN_NAME_MAX]; 
<a name="l00293"></a>00293         <span class="keyword">struct </span><span class="comment">/* anonymous structure */</span> {
<a name="l00294"></a><a class="code" href="structach__header__t.html#afe10c18fe3174cfffa275272d5eb513e">00294</a>             pthread_mutex_t mutex;         
<a name="l00295"></a><a class="code" href="structach__header__t.html#adf481b28dae0920d505cc4d54839258f">00295</a>             pthread_cond_t cond;           
<a name="l00296"></a>00296             <span class="keywordtype">int</span> dirty;
<a name="l00297"></a>00297         } sync;                   
<a name="l00298"></a>00298         <span class="comment">/* should force our alignment to 8-bytes... */</span>
<a name="l00299"></a><a class="code" href="structach__header__t.html#a2d14db42fa0de56fba848f84b236e233">00299</a>         uint64_t last_seq;        
<a name="l00300"></a>00300     } <a class="code" href="structach__header__t.html" title="Header for shared memory area.">ach_header_t</a>;
<a name="l00301"></a>00301 
<a name="l00304"></a><a class="code" href="structach__index__t.html">00304</a>     <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00305"></a><a class="code" href="structach__index__t.html#a09d62d5a30564852d0273797b7f6288f">00305</a>         <span class="keywordtype">size_t</span> size;      
<a name="l00306"></a><a class="code" href="structach__index__t.html#a8f36436d8e2236167e20f12a24f87963">00306</a>         <span class="keywordtype">size_t</span> offset;    
<a name="l00307"></a><a class="code" href="structach__index__t.html#ae36ca8f336ee4deaf32ee5b109cf0f56">00307</a>         uint64_t seq_num; 
<a name="l00308"></a>00308     } <a class="code" href="structach__index__t.html" title="Entry in shared memory index array.">ach_index_t</a> ;
<a name="l00309"></a>00309 
<a name="l00310"></a>00310 
<a name="l00312"></a><a class="code" href="structach__attr__t.html">00312</a>     <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00313"></a><a class="code" href="structach__attr__t.html#a28acf4026402daa2b322af32052160b2">00313</a>         <span class="keywordtype">int</span> map_anon;        
<a name="l00314"></a><a class="code" href="structach__attr__t.html#a9661e1da582c74766120408f5e9bfda2">00314</a>         <a class="code" href="structach__header__t.html" title="Header for shared memory area.">ach_header_t</a> *shm;   
<a name="l00315"></a>00315     } <a class="code" href="structach__attr__t.html" title="Attributes to pass to ach_open.">ach_attr_t</a>;
<a name="l00316"></a>00316 
<a name="l00317"></a>00317 
<a name="l00318"></a>00318 
<a name="l00320"></a><a class="code" href="structach__create__attr__t.html">00320</a>     <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00321"></a><a class="code" href="structach__create__attr__t.html#a6a71c790360ab2747a1e679d1fc529e9">00321</a>         <span class="keywordtype">int</span> truncate;      
<a name="l00322"></a><a class="code" href="structach__create__attr__t.html#a49290681ec1d48e1bbd4bebcee27df27">00322</a>         <span class="keywordtype">int</span> map_anon;      
<a name="l00323"></a><a class="code" href="structach__create__attr__t.html#a3bc28b142d07b12bb235d6ccc8028745">00323</a>         <a class="code" href="structach__header__t.html" title="Header for shared memory area.">ach_header_t</a> *shm; 
<a name="l00324"></a>00324     } <a class="code" href="structach__create__attr__t.html" title="Attributes to pass to ach_create.">ach_create_attr_t</a>;
<a name="l00325"></a>00325 
<a name="l00326"></a>00326 
<a name="l00329"></a><a class="code" href="structach__channel__t.html">00329</a>     <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00330"></a><a class="code" href="structach__channel__t.html#ad12d416ef130efe288fd186b3d6119bd">00330</a>         <a class="code" href="structach__header__t.html" title="Header for shared memory area.">ach_header_t</a> *shm;   
<a name="l00331"></a><a class="code" href="structach__channel__t.html#a90c8cfdb460ab6f8cdad5bd1920f011f">00331</a>         <span class="keywordtype">size_t</span> len;          
<a name="l00332"></a><a class="code" href="structach__channel__t.html#a1ca73e995dbe967ea54cba7f4a10d620">00332</a>         <span class="keywordtype">int</span> fd;              
<a name="l00333"></a><a class="code" href="structach__channel__t.html#a18e3834a2712f9c917391d64e0563c7d">00333</a>         uint64_t seq_num;    
<a name="l00334"></a><a class="code" href="structach__channel__t.html#ab3a79a84676f45c41499d7b62e07f959">00334</a>         uint64_t get_ticks;  
<a name="l00335"></a><a class="code" href="structach__channel__t.html#ac8a64b3537c4ec0d9b1b5ef84dd8b0ac">00335</a>         uint64_t put_ticks;  
<a name="l00336"></a><a class="code" href="structach__channel__t.html#a786e22cafe4161682dd63832c35f9102">00336</a>         <span class="keywordtype">size_t</span> next_index;   
<a name="l00337"></a><a class="code" href="structach__channel__t.html#a89379463e3c9b74bcda111f0bd91142d">00337</a>         <a class="code" href="structach__attr__t.html" title="Attributes to pass to ach_open.">ach_attr_t</a> attr;     
<a name="l00338"></a>00338     } <a class="code" href="structach__channel__t.html" title="Descriptor for shared memory area.">ach_channel_t</a>;
<a name="l00339"></a>00339 
<a name="l00341"></a>00341     <span class="keyword">extern</span> <span class="keywordtype">size_t</span> <a class="code" href="ach_8h.html#ab49bf40d8d514cd9c90044b570b6dbca" title="Size of ach_channel_t.">ach_channel_size</a>;
<a name="l00343"></a>00343     <span class="keyword">extern</span> <span class="keywordtype">size_t</span> <a class="code" href="ach_8h.html#a7bdba00f25de2f8ac2887056d0a34154" title="Size of ach_attr_t.">ach_attr_size</a>;
<a name="l00344"></a>00344 
<a name="l00346"></a><a class="code" href="ach_8h.html#a8448a67475a582f8515335a3e88c8856">00346</a> <span class="preprocessor">#define ACH_SHM_GUARD_HEADER( shm ) ((uint64_t*)((ach_header_t*)(shm) + 1))</span>
<a name="l00347"></a>00347 <span class="preprocessor"></span>
<a name="l00349"></a><a class="code" href="ach_8h.html#a1a58bc54a5ccd573e5d6185696c5b93f">00349</a> <span class="preprocessor">#define ACH_SHM_INDEX( shm ) ((ach_index_t*)(ACH_SHM_GUARD_HEADER(shm) + 1))</span>
<a name="l00350"></a>00350 <span class="preprocessor"></span>
<a name="l00352"></a><a class="code" href="ach_8h.html#a8daa921151d1ad687da018f8caf072d2">00352</a> <span class="preprocessor">#define ACH_SHM_GUARD_INDEX( shm )                                      \</span>
<a name="l00353"></a>00353 <span class="preprocessor">    ((uint64_t*)(ACH_SHM_INDEX(shm) + ((ach_header_t*)(shm))-&gt;index_cnt))</span>
<a name="l00354"></a>00354 <span class="preprocessor"></span>
<a name="l00356"></a><a class="code" href="ach_8h.html#af61e34af50bd47ecc2ef3f5bdc77e545">00356</a> <span class="preprocessor">#define ACH_SHM_DATA( shm ) ( (uint8_t*)(ACH_SHM_GUARD_INDEX(shm) + 1) )</span>
<a name="l00357"></a>00357 <span class="preprocessor"></span>
<a name="l00359"></a><a class="code" href="ach_8h.html#af20a50fe51b61358d83442841d2182ea">00359</a> <span class="preprocessor">#define ACH_SHM_GUARD_DATA( shm )                                       \</span>
<a name="l00360"></a>00360 <span class="preprocessor">    ((uint64_t*)(ACH_SHM_DATA(shm) + ((ach_header_t*)(shm))-&gt;data_size))</span>
<a name="l00361"></a>00361 <span class="preprocessor"></span>
<a name="l00362"></a>00362 
<a name="l00364"></a>00364     <span class="keywordtype">void</span> <a class="code" href="ach_8h.html#a860d84dfee4d1306fe58df7b073c440a" title="Initialize attributes for opening channels.">ach_attr_init</a>( <a class="code" href="structach__attr__t.html" title="Attributes to pass to ach_open.">ach_attr_t</a> *attr );
<a name="l00365"></a>00365 
<a name="l00367"></a>00367     <span class="keywordtype">void</span> <a class="code" href="ach_8h.html#a1fa91ef1ccb0e3521a8b1d6ecfd2a66c" title="Initialize attributes for creating channels.">ach_create_attr_init</a>( <a class="code" href="structach__create__attr__t.html" title="Attributes to pass to ach_create.">ach_create_attr_t</a> *attr );
<a name="l00368"></a>00368 
<a name="l00375"></a>00375     <span class="keywordtype">int</span> <a class="code" href="ach_8h.html#afd514236f7ce7b32dd4481c9a2d66577" title="Creates a new channel.">ach_create</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *channel_name,
<a name="l00376"></a>00376                     <span class="keywordtype">size_t</span> frame_cnt, <span class="keywordtype">size_t</span> frame_size,
<a name="l00377"></a>00377                     <a class="code" href="structach__create__attr__t.html" title="Attributes to pass to ach_create.">ach_create_attr_t</a> *attr);
<a name="l00378"></a>00378 
<a name="l00381"></a>00381     <span class="keywordtype">int</span> <a class="code" href="ach_8h.html#a21a9ce88a3b3b52003c221e17fee9bad" title="Opens a handle to channel.">ach_open</a>(<a class="code" href="structach__channel__t.html" title="Descriptor for shared memory area.">ach_channel_t</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *channel_name,
<a name="l00382"></a>00382                  <a class="code" href="structach__attr__t.html" title="Attributes to pass to ach_open.">ach_attr_t</a> *attr);
<a name="l00383"></a>00383 
<a name="l00384"></a>00384 
<a name="l00393"></a>00393     <span class="keywordtype">int</span> <a class="code" href="ach_8h.html#a9ddb76fad51fdf8c98628b94405f400f" title="Pulls the next message from a channel following the most recent message this subscriber has read...">ach_get_next</a>(<a class="code" href="structach__channel__t.html" title="Descriptor for shared memory area.">ach_channel_t</a> *chan, <span class="keywordtype">void</span> *buf, <span class="keywordtype">size_t</span> size, <span class="keywordtype">size_t</span> *frame_size);
<a name="l00394"></a>00394 
<a name="l00396"></a>00396     <span class="keywordtype">int</span> <a class="code" href="ach_8h.html#ac8ae7ed660eacc104755d3de9ddb60b6" title="like ach_get_next but blocks if no new data is there">ach_wait_next</a>(<a class="code" href="structach__channel__t.html" title="Descriptor for shared memory area.">ach_channel_t</a> *chan, <span class="keywordtype">void</span> *buf, <span class="keywordtype">size_t</span> size, <span class="keywordtype">size_t</span> *frame_size,
<a name="l00397"></a>00397                       <span class="keyword">const</span> <span class="keyword">struct</span> timespec *<a class="code" href="ach_8h.html#a36320691b8bddb17d7416a7c57e296f5" title="Alias restrict keyword.">ACH_RESTRICT</a> abstime);
<a name="l00398"></a>00398 
<a name="l00419"></a>00419     <span class="keywordtype">int</span> <a class="code" href="ach_8h.html#a7d6698b403bcb0952979674b69731e34" title="Pulls the most recent message from the channel.">ach_get_last</a>(<a class="code" href="structach__channel__t.html" title="Descriptor for shared memory area.">ach_channel_t</a> *chan, <span class="keywordtype">void</span> *buf,
<a name="l00420"></a>00420                      <span class="keywordtype">size_t</span> size, <span class="keywordtype">size_t</span> *frame_size);
<a name="l00421"></a>00421 
<a name="l00423"></a>00423     <span class="keywordtype">int</span> <a class="code" href="ach_8h.html#ac17d0ce8887791805a6571ba8c912706" title="always copies the last message, even if it is stale">ach_copy_last</a>(<a class="code" href="structach__channel__t.html" title="Descriptor for shared memory area.">ach_channel_t</a> *chan, <span class="keywordtype">void</span> *buf,
<a name="l00424"></a>00424                       <span class="keywordtype">size_t</span> size, <span class="keywordtype">size_t</span> *frame_size);
<a name="l00425"></a>00425 
<a name="l00426"></a>00426 
<a name="l00435"></a>00435     <span class="keywordtype">int</span> <a class="code" href="ach_8h.html#a79118c8d91f1b014274099004fcb46e8" title="Blocks until a new message is available.">ach_wait_last</a>( <a class="code" href="structach__channel__t.html" title="Descriptor for shared memory area.">ach_channel_t</a> *chan, <span class="keywordtype">void</span> *buf, <span class="keywordtype">size_t</span> size, <span class="keywordtype">size_t</span> *frame_size,
<a name="l00436"></a>00436                        <span class="keyword">const</span> <span class="keyword">struct</span> timespec *<a class="code" href="ach_8h.html#a36320691b8bddb17d7416a7c57e296f5" title="Alias restrict keyword.">ACH_RESTRICT</a> abstime);
<a name="l00437"></a>00437 
<a name="l00438"></a>00438 
<a name="l00448"></a>00448     <span class="keywordtype">int</span> <a class="code" href="ach_8h.html#aaaf49ffc081328edc26f75221134a6fb" title="Pulls a message from the channel.">ach_get</a>( <a class="code" href="structach__channel__t.html" title="Descriptor for shared memory area.">ach_channel_t</a> *chan, <span class="keywordtype">void</span> *buf, <span class="keywordtype">size_t</span> size,
<a name="l00449"></a>00449                  <span class="keywordtype">size_t</span> *frame_size,
<a name="l00450"></a>00450                  <span class="keyword">const</span> <span class="keyword">struct</span> timespec *<a class="code" href="ach_8h.html#a36320691b8bddb17d7416a7c57e296f5" title="Alias restrict keyword.">ACH_RESTRICT</a> abstime,
<a name="l00451"></a>00451                  <a class="code" href="ach_8h.html#ae42d0299e86224c0ac39dc58959bd7fe" title="Option flags for ach_get().">ach_get_opts_t</a> options );
<a name="l00452"></a>00452 
<a name="l00465"></a>00465     <span class="keywordtype">int</span> <a class="code" href="ach_8h.html#a51fa85001904de91e22930d8ad330504" title="Writes a new message in the channel.">ach_put</a>(<a class="code" href="structach__channel__t.html" title="Descriptor for shared memory area.">ach_channel_t</a> *chan, <span class="keywordtype">void</span> *buf, <span class="keywordtype">size_t</span> len);
<a name="l00466"></a>00466 
<a name="l00467"></a>00467 
<a name="l00471"></a>00471     <span class="keywordtype">int</span> <a class="code" href="ach_8h.html#a725e22a4d865f91be864cea250995a85" title="Discards all previously received messages for this handle.">ach_flush</a>( <a class="code" href="structach__channel__t.html" title="Descriptor for shared memory area.">ach_channel_t</a> *chan );
<a name="l00472"></a>00472 
<a name="l00479"></a>00479     <span class="keywordtype">int</span> <a class="code" href="ach_8h.html#acdc4d4306efc8e553dd9c58247f98d00" title="Closes the shared memory block.">ach_close</a>(<a class="code" href="structach__channel__t.html" title="Descriptor for shared memory area.">ach_channel_t</a> *chan);
<a name="l00480"></a>00480 
<a name="l00481"></a>00481 
<a name="l00484"></a>00484     <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ach_8h.html#a11e481d90a14ba4485d3bb15a8bb77c3" title="Converts return code from ach call to a human readable string;.">ach_result_to_string</a>(<a class="code" href="ach_8h.html#a6d56e0e44a3792918ce459a4a8deaad4" title="return status codes for ach functions">ach_status_t</a> result);
<a name="l00485"></a>00485 
<a name="l00486"></a>00486 
<a name="l00491"></a>00491     <span class="keywordtype">void</span> <a class="code" href="ach_8h.html#adccdafda2936a9f70087f950ba7e83e8" title="Prints information about the channel shm to stderr.">ach_dump</a>( <a class="code" href="structach__header__t.html" title="Header for shared memory area.">ach_header_t</a> *shm);
<a name="l00492"></a>00492 
<a name="l00494"></a><a class="code" href="ach_8h.html#abaa663b4780171e76fc25289bab544e4">00494</a> <span class="preprocessor">#define ACH_STREAM_PREFIX_SIZE  12</span>
<a name="l00495"></a>00495 <span class="preprocessor"></span>
<a name="l00497"></a>00497     ssize_t <a class="code" href="ach_8h.html#abecb8fa38611d7bb9201a66825756d66" title="Writes message pointed to by but to stream fd.">ach_stream_write_msg</a>( <span class="keywordtype">int</span> fd, <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> cnt);
<a name="l00498"></a>00498 
<a name="l00500"></a>00500     ssize_t <a class="code" href="ach_8h.html#a766ac112d3b577b197242f87219fc04e" title="Reads the size of a message from fd and stores in cnt.">ach_stream_read_msg_size</a>( <span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> *cnt);
<a name="l00501"></a>00501 
<a name="l00503"></a>00503     ssize_t <a class="code" href="ach_8h.html#afa510a3949daf4ac78ad411afccd547b" title="Reads msg_size bytes of data from fd and stores in buf.">ach_stream_read_msg_data</a>( <span class="keywordtype">int</span> fd, <span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> msg_size, <span class="keywordtype">size_t</span> buf_size);
<a name="l00504"></a>00504 
<a name="l00505"></a>00505 
<a name="l00507"></a>00507     ssize_t <a class="code" href="ach_8h.html#ad33a09b98150fad192879cf30a1d78bf" title="Reads from fd into buffer completely.">ach_stream_read_fill</a>( <span class="keywordtype">int</span> fd, <span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> cnt );
<a name="l00508"></a>00508 
<a name="l00510"></a>00510     ssize_t <a class="code" href="ach_8h.html#a6d78f1addd2a63c589bc87391d0fb5aa" title="Writes from buffer into fd completely.">ach_stream_write_fill</a>( <span class="keywordtype">int</span> fd, <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> cnt );
<a name="l00511"></a>00511 
<a name="l00513"></a>00513     ssize_t <a class="code" href="ach_8h.html#ac837554b2554043cf1e6fcba757c38aa" title="Reads a line from fd.">ach_read_line</a>( <span class="keywordtype">int</span> fd, <span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> cnt );
<a name="l00514"></a>00514 
<a name="l00516"></a>00516     <span class="keywordtype">int</span> <a class="code" href="ach_8h.html#aeaa9e735f7c59622e5926c4df7b52928" title="Sets permissions of chan to specified mode.">ach_chmod</a>( <a class="code" href="structach__channel__t.html" title="Descriptor for shared memory area.">ach_channel_t</a> *chan, mode_t mode );
<a name="l00517"></a>00517 
<a name="l00519"></a>00519     <span class="keywordtype">int</span> <a class="code" href="ach_8h.html#aacbf444d769cf34acaa53854c0490c69" title="Delete an ach channel.">ach_unlink</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *name );
<a name="l00520"></a>00520 
<a name="l00521"></a>00521 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l00522"></a>00522 <span class="preprocessor"></span>}
<a name="l00523"></a>00523 <span class="preprocessor">#endif</span>
<a name="l00524"></a>00524 <span class="preprocessor"></span>
<a name="l00525"></a>00525 <span class="preprocessor">#endif </span><span class="comment">/* ACH_H */</span>
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Sun Aug 26 2012 17:54:07 for ach by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
